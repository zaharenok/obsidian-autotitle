# AutoTitle Obsidian Plugin - Development Notes

## Project Overview
This is an Obsidian plugin that automatically generates titles for notes using OpenAI's GPT models.

## Recent Changes (August 2025)

### New Features Added:
1. **Auto Replace Mode** (`autoReplaceMode`)
   - When enabled, automatic title generation happens WITHOUT confirmation dialogs
   - Setting: "Auto Replace Mode" - "For auto-generation: replace titles without showing confirmation dialog"

2. **Auto-Ignore Processed Notes** (`autoIgnoreDeclined`)  
   - When title generation happens (accepted OR declined), the note is automatically added to ignore list
   - The note won't be suggested for title generation again
   - Setting: "Auto-ignore processed notes" (enabled by default)
   - **CRITICAL**: Works for both successful generation AND declined suggestions

3. **Ignore List Management** (`ignoredFiles`)
   - Stores array of file paths that should be ignored for auto-generation
   - Can be cleared via "Clear ignore list" button in settings
   - Shows count of ignored files in settings interface

### Interface Language
- **All interface text is now in English**
- Removed Russian localization logic from `getLocalizedTexts()`
- All `showNotice()` messages translated to English
- Modal dialog buttons and text in English

### Settings Structure
```javascript
DEFAULT_SETTINGS = {
  // ... existing settings ...
  autoReplaceMode: true,         // NEW: Auto-replace without confirmation (enabled by default)
  autoIgnoreDeclined: true,      // NEW: Auto-ignore ALL processed notes (accepted OR declined)
  ignoredFiles: [],              // NEW: Array of ignored file paths
  maxTitleLength: 100,           // FIXED: AI now generates titles within this limit instead of truncating
  // ... other settings ...
}
```

### Key Functions Modified:
- `autoGenerateTitle()` - **ALWAYS auto-replaces without dialog** (automatic generation)
- `generateTitleForEditor()` - Added autoReplaceMode logic (manual generation)
- `generateTitleForFile()` - Added autoReplaceMode logic (manual generation)  
- `showTitleSuggestionModal()` - Added auto-ignore functionality
- `getLocalizedTexts()` - Simplified to English only
- `generateTitle()` - **CRITICAL FIX**: Now takes maxTitleLength parameter and instructs AI to generate within limit
- `validateAndTruncateTitle()` - **CRITICAL FIX**: Removed truncation logic, now just trims title

### CRITICAL BEHAVIOR:
- **Automatic generation** (`autoGenerateTitle`) - NEVER shows confirmation dialog
- **Manual generation** (hotkeys, buttons) - Respects `autoReplaceMode` setting
- This ensures auto-generation is truly automatic while preserving user choice for manual generation

### Git Issues Resolved:
- Fixed multiple merge conflicts in the codebase
- Resolved syntax errors from unresolved merge markers

## Development Commands

### Testing
```bash
# Check syntax
node -c main.js

# No specific test framework detected
```

### Build Process
- This appears to be a pre-built plugin (main.js is bundled by esbuild)
- Source TypeScript files not present in this directory
- The main.js file contains bundled code with comment: "THIS IS A GENERATED/BUNDLED FILE BY ESBUILD"

## Important Notes for Future Development

### When making changes:
1. **Always check for merge conflicts** before committing
2. **Test syntax** with `node -c main.js`  
3. **Keep interface in English** - users prefer English interface
4. **AutoReplaceMode logic** should be checked in ALL generation functions
5. **Ignore list functionality** should work across all entry points

### Settings Dependencies:
- `autoReplaceMode` affects: autoGenerateTitle, generateTitleForEditor, generateTitleForFile
- `autoIgnoreDeclined` affects: showTitleSuggestionModal, generateTitleForFile callback
- `ignoredFiles` affects: All generation functions should check this array

### User Workflow:
1. User enables "Auto Replace Mode" in settings (enabled by default)
2. When typing in a note, auto-generation triggers after timeout
3. Title is automatically replaced WITHOUT showing confirmation dialog
4. **IMPORTANT**: After ANY title generation (successful or declined), note is automatically added to ignore list
5. Ignored notes won't trigger auto-generation anymore - **"one and done" behavior**
6. User can clear ignore list via settings if needed

## Troubleshooting

### Common Issues:
1. **Modal still shows**: Check that autoReplaceMode logic is added to ALL generation functions
2. **Russian text appears**: Check getLocalizedTexts() and all showNotice() calls  
3. **Merge conflicts**: Look for `<<<<<<<`, `=======`, `>>>>>>>` markers
4. **Syntax errors**: Run `node -c main.js` to check
5. **Titles truncated**: 
   - ✅ COMPLETELY FIXED: Two-level fix implemented
   - Level 1: AI generates titles within maxTitleLength limit via prompt constraint
   - Level 2: validateAndTruncateTitle() no longer truncates (just trims whitespace)
   - Old problem: AI generated long titles → validateAndTruncateTitle truncated them
   - New solution: AI generates proper length + no post-processing truncation

### Settings Location:
- Settings UI: Settings Tab → Community Plugins → AutoTitle  
- Settings file: `.obsidian/plugins/autotitle/data.json`

# TO MEMORIZE - CRITICAL POINTS

## The Ultimate Solution Achieved:
1. **Auto-generation WITHOUT any dialogs** - `autoGenerateTitle()` always replaces directly
2. **"One and done" behavior** - Every processed note (accepted OR declined) goes to ignore list  
3. **AI generates proper length titles** - Two-level fix: AI prompt constraint + removed post-processing truncation
4. **English interface only** - All Russian text removed, `getLocalizedTexts()` simplified
5. **All settings optimized** - `autoReplaceMode: true`, `autoIgnoreDeclined: true` by default

## Key Architecture Decisions:
- **Automatic vs Manual generation** - Different behavior for different entry points
- **AI prompt engineering** - Length constraint passed to OpenAI, not post-processed
- **Ignore list management** - Unified across all generation functions
- **Settings as source of truth** - `maxTitleLength` flows from settings to AI prompt

## Most Important Functions:
- `autoGenerateTitle()` - NEVER shows dialogs, always auto-replaces
- `generateTitle()` - Takes maxTitleLength parameter, instructs AI accordingly
- All generation functions check ignore list and add successful/declined notes to it

Last updated: August 26, 2025